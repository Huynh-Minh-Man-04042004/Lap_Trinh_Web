<?xml version="1.0" encoding="UTF-8"?>
<web-app xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="https://jakarta.ee/xml/ns/jakartaee" xsi:schemaLocation="https://jakarta.ee/xml/ns/jakartaee https://jakarta.ee/xml/ns/jakartaee/web-app_5_0.xsd" id="WebApp_ID" version="5.0">
  <display-name>22110377_Man</display-name>
  <welcome-file-list>
    <welcome-file>index.jsp</welcome-file>
  </welcome-file-list>
</web-app>























<!-- Package beans:

Class ThuongHieu:

package beans;

public class ThuongHieu {
	int thuongHieuId;
	String tenThuongHieu;
	public int getThuongHieuId() {
		return thuongHieuId;
	}
	public void setThuongHieuId(int thuongHieuId) {
		this.thuongHieuId = thuongHieuId;
	}
	public String getTenThuongHieu() {
		return tenThuongHieu;
	}
	public void setTenThuongHieu(String tenThuongHieu) {
		this.tenThuongHieu = tenThuongHieu;
	}
	public ThuongHieu(int thuongHieuId, String tenThuongHieu) {
		this.thuongHieuId = thuongHieuId;
		this.tenThuongHieu = tenThuongHieu;
	}
	
}

Class XeHoi:

package beans;

public class XeHoi {
	String maXH;
	int thuongHieuId;
	float giaBan;
	int namXX;
	ThuongHieu thuongHieu;
	public String getMaXH() {
		return maXH;
	}
	public void setMaXH(String maXH) {
		this.maXH = maXH;
	}
	public int getThuongHieuId() {
		return thuongHieuId;
	}
	public void setThuongHieuId(int thuongHieuId) {
		this.thuongHieuId = thuongHieuId;
	}
	public float getGiaBan() {
		return giaBan;
	}
	public void setGiaBan(float giaBan) {
		this.giaBan = giaBan;
	}
	public int getNamXX() {
		return namXX;
	}
	public void setNamXX(int namXX) {
		this.namXX = namXX;
	}
	public ThuongHieu getThuongHieu() {
		return thuongHieu;
	}
	public void setThuongHieu(ThuongHieu thuongHieu) {
		this.thuongHieu = thuongHieu;
	}
	public XeHoi(String maXH, int thuongHieuId, float giaBan, int namXX, ThuongHieu thuongHieu) {
		this.maXH = maXH;
		this.thuongHieuId = thuongHieuId;
		this.giaBan = giaBan;
		this.namXX = namXX;
		this.thuongHieu = thuongHieu;
	}
	
}


Package dao:

Class XeHoiDao:

package dao;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.util.ArrayList;
import java.util.List;

import beans.ThuongHieu;
import beans.XeHoi;
import service.connectDB;

public class XeHoiDao {
	public static List<XeHoi> DS() {
		List<XeHoi> kq = new ArrayList<XeHoi>();
		Connection db = connectDB.DB();
		String sql="Select * from XeHoi join ThuongHieu on XeHoi.thuongHieuId = ThuongHieu.thuongHieuId";
		try {
			PreparedStatement state = db.prepareStatement(sql);
			ResultSet rs = state.executeQuery();
			while(rs.next()) {
				kq.add(new XeHoi(rs.getString(1), rs.getInt(2), rs.getFloat(3), rs.getInt(4), new ThuongHieu(rs.getInt(5), rs.getString(6))));
			}
			return kq;
		} catch (Exception e) {
			// TODO: handle exception
		}
		return kq;
	}
	
	public static List<XeHoi> DSTheoTH(int maTH) {
		List<XeHoi> kq = new ArrayList<XeHoi>();
		Connection db = connectDB.DB();
		String sql="Select * from XeHoi join ThuongHieu on XeHoi.thuongHieuId = ThuongHieu.thuongHieuId where ThuongHieu.thuongHieuId = ?";
		try {
			PreparedStatement state = db.prepareStatement(sql);
			state.setInt(1, maTH);
			ResultSet rs = state.executeQuery();
			while(rs.next()) {
				kq.add(new XeHoi(rs.getString(1), rs.getInt(2), rs.getFloat(3), rs.getInt(4), new ThuongHieu(rs.getInt(5), rs.getString(6))));
			}
			return kq;
		} catch (Exception e) {
			// TODO: handle exception
		}
		return kq;
	}
	
	public static XeHoi layxe(String Ma) {
		XeHoi kq = null;
		Connection db = connectDB.DB();
		String sql="Select * from XeHoi join ThuongHieu on XeHoi.thuongHieuId = ThuongHieu.thuongHieuId where maXH = ?";
		try {
			PreparedStatement state = db.prepareStatement(sql);
			state.setString(1, Ma);
			ResultSet rs = state.executeQuery();
			while(rs.next()) {
				kq =new XeHoi(rs.getString(1), rs.getInt(2), rs.getFloat(3), rs.getInt(4), new ThuongHieu(rs.getInt(5), rs.getString(6)));
			}
			return kq;
		} catch (Exception e) {
			// TODO: handle exception
		}
		return kq;
	}
	public static List<ThuongHieu> DSThuongHieu() {
		List<ThuongHieu> kq = new ArrayList<ThuongHieu>();
		Connection db = connectDB.DB();
		String sql="Select * from ThuongHieu";
		try {
			PreparedStatement state = db.prepareStatement(sql);
			ResultSet rs = state.executeQuery();
			while(rs.next()) {
				kq.add(new ThuongHieu(rs.getInt(1), rs.getString(2)));
			}
			return kq;
		} catch (Exception e) {
			// TODO: handle exception
		}
		return kq;
	}
	
	public static boolean Sua(int idth, float gia, int namxx, String maXH) {
		Connection db = connectDB.DB();
		String sql="update XeHoi set thuongHieuId=?, giaban=?, namXX=? where maXH = ?";
		try {
			PreparedStatement state = db.prepareStatement(sql);
			state.setInt(1, idth);
			state.setFloat(2, gia);
			state.setInt(3, namxx);
			state.setString(4, maXH);
			state.execute();
			return true;
		} catch (Exception e) {
			// TODO: handle exception
		}
		return false;
	}
	
	public static boolean Them(int idth, float gia, int namxx, String maXH) {
		Connection db = connectDB.DB();
		String sql="insert into XeHoi values(?, ?, ?,?);";
		try {
			PreparedStatement state = db.prepareStatement(sql);
			state.setString(1, maXH);
			state.setInt(2, idth);
			state.setFloat(3, gia);
			state.setInt(4, namxx);
			state.execute();
			return true;
		} catch (Exception e) {
			// TODO: handle exception
		}
		return false;
	}
	
	public static boolean Xoa(String maXH) {
		Connection db = connectDB.DB();
		String sql="Delete XeHoi where maXH = ?";
		try {
			PreparedStatement state = db.prepareStatement(sql);
			state.setString(1, maXH);
			state.execute();
			return true;
		} catch (Exception e) {
			// TODO: handle exception
		}
		return false;
	}
}


Package service:

Class connectDB:

package service;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.SQLException;

public class connectDB {
	public static Connection DB () {
		Connection con = null;
		String username = "sa";
        String password = "123456";
        String nameDatabase ="LTWeb_Ktr";
        String nameLap="localhost\\SQLEXPRESS01";
        String url = "jdbc:sqlserver://"+nameLap+":1433;databaseName="+nameDatabase+";encrypt=false";
		try {
			Class.forName("com.microsoft.sqlserver.jdbc.SQLServerDriver");
			con = DriverManager.getConnection(url,username,password);
		} catch (ClassNotFoundException | SQLException e) {
			System.out.println(e);
		} 	
		return con;
	} 
}

Package servlets:

Servlet DSservlet:

package servlets;

import jakarta.servlet.ServletException;
import jakarta.servlet.annotation.WebServlet;
import jakarta.servlet.http.HttpServlet;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;
import java.io.IOException;
import java.util.List;

import beans.ThuongHieu;
import beans.XeHoi;
import dao.XeHoiDao;

@WebServlet(urlPatterns = "/ds",name = "ds")
public class DSservlet extends HttpServlet {
	private static final long serialVersionUID = 1L;
    public DSservlet() {
        super();
    }

	protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		List<ThuongHieu> thuongHieu = XeHoiDao.DSThuongHieu();
		request.setAttribute("thuongHieu", thuongHieu);
		if(request.getParameter("locid")!=null) {
			if(!request.getParameter("locid").equals("Tất cả")) {
				request.setAttribute("kq", Integer.parseInt(request.getParameter("locid")));
				List<XeHoi> list = XeHoiDao.DSTheoTH(Integer.parseInt(request.getParameter("locid")));
				request.setAttribute("list", list);
			}else {
				List<XeHoi> list = XeHoiDao.DS();
				request.setAttribute("list", list);
			}
			request.getRequestDispatcher("ds.jsp").forward(request, response);
		}else {
			List<XeHoi> list = XeHoiDao.DS();
			request.setAttribute("list", list);
			request.getRequestDispatcher("ds.jsp").forward(request, response);
		}
	}

	protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		doGet(request, response);
	}

}


Servlet Sua:

package servlets;

import jakarta.servlet.ServletException;
import jakarta.servlet.annotation.WebServlet;
import jakarta.servlet.http.HttpServlet;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;
import java.io.IOException;
import java.util.List;

import beans.ThuongHieu;
import beans.XeHoi;
import dao.XeHoiDao;

@WebServlet(urlPatterns = "/sua",name = "sua")
public class Sua extends HttpServlet {
	private static final long serialVersionUID = 1L;

    public Sua() {
        super();
    }

	protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		String ma = request.getParameter("maXH");
		XeHoi item = XeHoiDao.layxe(ma);
		List<ThuongHieu> list = XeHoiDao.DSThuongHieu();
		request.setAttribute("item", item);
		request.setAttribute("list", list);
		request.getRequestDispatcher("sua.jsp").forward(request, response);
	}

	protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		String ma = request.getParameter("maXH");
		XeHoi item = XeHoiDao.layxe(ma);
		if(item!=null) {
			int idth = Integer.parseInt(request.getParameter("thuongHieuId"));
			float giaBan = Float.parseFloat(request.getParameter("giaBan"));
			int namXX = Integer.parseInt(request.getParameter("namXX"));
			System.out.println(idth+" " +giaBan+" " +namXX+" "+ ma);
			XeHoiDao.Sua(idth, giaBan, namXX, ma);
			response.sendRedirect("/laptrinh/ds");
		}else {
			int idth = Integer.parseInt(request.getParameter("thuongHieuId"));
			float giaBan = Float.parseFloat(request.getParameter("giaBan"));
			int namXX = Integer.parseInt(request.getParameter("namXX"));
			XeHoiDao.Them(idth, giaBan, namXX, ma);
			response.sendRedirect("/laptrinh/ds");
		}
	}

}

Servlet Xoa:

package servlets;

import jakarta.servlet.ServletException;
import jakarta.servlet.annotation.WebServlet;
import jakarta.servlet.http.HttpServlet;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;
import java.io.IOException;

import dao.XeHoiDao;

@WebServlet(urlPatterns = "/xoa",name = "xoa")
public class Xoa extends HttpServlet {
	private static final long serialVersionUID = 1L;
       
    public Xoa() {
        super();
    }

	protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		String ma =request.getParameter("maXH");
		XeHoiDao.Xoa(ma);
		response.sendRedirect("/laptrinh/ds");
	}

	protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		doGet(request, response);
	}

}


ds.jsp:

<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@taglib prefix="c" uri="jakarta.tags.core" %>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Danh sách xe hơi</title>
<style type="text/css">
    table, td, th {
        border: solid 1px black;
    }
</style>
</head>
<body>
    <h1>Danh Sách Xe Hơi</h1>
    <form action="/laptrinh/ds" method="get" id="loc">
        <label for="locid">Lọc theo thương hiệu:</label>
        <select name="locid" id="locid" onchange="submitForm()">
            <option value="Tất cả">Tất cả</option>
            <c:forEach var="th" items="${thuongHieu}">
                <option value="${th.thuongHieuId}" ${th.thuongHieuId == kq ? 'selected' : ''}>${th.tenThuongHieu}</option>
            </c:forEach>
        </select>
        <br><br>
    </form>

    <table cellpadding="10" cellspacing="0">
        <thead>
            <tr>
                <th>STT</th>
                <th>Mã xe</th>
                <th>Thương hiệu</th>
                <th>Giá bán</th>
                <th>Năm xuất xưởng</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            <c:forEach var="item" items="${list}" varStatus="status">
                <tr>
                    <td>${status.index + 1}</td>
                    <td>${item.maXH}</td>
                    <td>${item.thuongHieu.tenThuongHieu}</td>
                    <td>${item.giaBan}</td>
                    <td>${item.namXX}</td>
                    <td>
                        <a href="/laptrinh/sua?maXH=${item.maXH}">Sửa</a> |
                        <a href="/laptrinh/xoa?maXH=${item.maXH}" onclick="return deleteConf()">Xóa</a>
                    </td>
                </tr>
            </c:forEach>
        </tbody>
    </table>

    <script type="text/javascript">
        function deleteConf() {
            return confirm("Bạn có chắc chắn muốn xóa?");
        }
        function submitForm() {
            document.getElementById("loc").submit();
        }
    </script>
</body>
</html>


sua.jsp:

<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@taglib prefix="c" uri="jakarta.tags.core" %>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Chỉnh sửa thông tin xe</title>
</head>
<body>
    <h1>Chỉnh Sửa Thông Tin Xe Hơi</h1>
    <form action="/laptrinh/sua" method="post">
        <input type="hidden" name="maXH" value="${item.maXH}" />

        <label for="thuongHieu">Thương hiệu:</label>
        <select name="thuongHieuId" id="thuongHieu">
            <c:forEach var="th" items="${thuongHieu}">
                <option value="${th.thuongHieuId}" ${th.thuongHieuId == item.thuongHieu.thuongHieuId ? 'selected' : ''}>${th.tenThuongHieu}</option>
            </c:forEach>
        </select>
        <br><br>

        <label for="giaBan">Giá bán:</label>
        <input type="text" id="giaBan" name="giaBan" value="${item.giaBan}" required />
        <br><br>

        <label for="namXX">Năm xuất xưởng:</label>
        <input type="text" id="namXX" name="namXX" value="${item.namXX}" required />
        <br><br>

        <button type="submit">Cập nhật</button>
        <button type="button" onclick="window.location.href='/laptrinh/ds'">Hủy</button>
    </form>
</body>
</html>
 -->